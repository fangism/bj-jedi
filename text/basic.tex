% "basic.tex"

\chapter{Basic Strategy}
\label{sec:basic}

This chapter not only reveals the well-known optimal basic strategy
of Blackjack, but it also mathematically derives the strategy 
in great detail.

Assumptions: infinite deck approximation, as if cards drawn are
immediately replaced to eliminate the effects of history.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Hit vs. Stand}
\label{sec:basic:hit-stand}

The most common decision the player faces in any situation
is whether to hit or stand.
It is also the most important to learn and master first.

\subsection{Standing}
\label{sec:basic:hit-stand:stand}

\begin{table}[ht!]
\caption{Player's stand edges (H17, pre-peek)}
\begin{center}
\input tables/player-stand-H17-pre-peek
\end{center}
\label{tab:player-stand-H17-pre-peek}
\end{table}

\begin{table}[ht!]
\caption{Player's stand edges (H17, post-peek)}
\begin{center}
\input tables/player-stand-H17-post-peek
\end{center}
\label{tab:player-stand-H17-post-peek}
\end{table}

If we combine Table~\ref{tab:win-lose} and
Table~\ref{tab:dealer-final-H17-pre-peek} (pre-peek, H17) 
using outcome weights of $+1$ for a win, $-1$ for lose, and $0$ for push, 
the result is the expected winnings per unit bet, 
is Table~\ref{tab:player-stand-H17-pre-peek}.
Note that a player natural blackjack (row:BJ) is weighted by the 
blackjack payoff of $3:2$ ($+1.5$).
With any other blackjack payoff, this row would be re-computed accordingly.

For post-peek conditions, Table~\ref{tab:win-lose} is combined with
Table~\ref{tab:dealer-final-H17-post-peek} (post-peek, H17) to produce
Table~\ref{tab:player-stand-H17-post-peek}.
The only columns which differ between these tables are when
the dealer's reveal card is an Ace or 10, since those are the only cards
that provide information about the hole card
when the dealer peeks for blackjack.

Intuitively, as the player's hand value increases up to 21, 
her expected outcome also monotonically increases.
This is trend is expected because the corresponding player value rows in
Table~\ref{tab:win-lose} show the sets of winning scenarios
grow with hand value, and the set of losing scenarios diminish with
hand value.  

\begin{table}[ht!]
\caption{Player's stand edges (S17, pre-peek)}
\begin{center}
\input tables/player-stand-S17-pre-peek
\end{center}
\label{tab:player-stand-S17-pre-peek}
\end{table}

\begin{table}[ht!]
\caption{Player's stand edges (S17, post-peek)}
\begin{center}
\input tables/player-stand-S17-post-peek
\end{center}
\label{tab:player-stand-S17-post-peek}
\end{table}

For the S17 variation, the same computation produces
Table~\ref{tab:player-stand-S17-pre-peek} (pre-peek), and
Table~\ref{tab:player-stand-S17-post-peek} (post-peek).

Decision evaluations will use the post-peek tables when
comparing to against the expected outcomes of other actions, 
because the player does not have a chance to act before
being assured that the dealer does not have blackjack.  
% exception: no peek variation

\subsection{Hitting}
\label{sec:basic:hit-stand:hit}

The obvious hit decisions are when the player's hand is 11 or lower,
as it cannot result in a bust, and since any total $\le{}16$ is
worth the same, the hand can only improve by hitting.  
% If it is better to stand than hit at X, then it is also better to
% stand than hit at all X+k (for hard totals).

The expected outcome of hitting in each state $s_i$ 
can be computed recursively using the following equations:

\begin{eqnarray}
\ExpOpt{s_i} &=& \Max{\ExpAct{hit}{s_i}}{\ExpAct{stand}{s_i}}\\
\ExpAct{hit}{s_i} &=& \Sum{j=1}{10}{\Prob{c=j}\ExpOpt{s_{i\rightarrow{}j}}}
\end{eqnarray}

\noindent
To follow dependency ordering, the expectations $\ExpAct{hit}{s_i}$
must be evaluated starting from the player's terminal states 
(21, bust) and working backwards.  

\begin{center}
\begin{longtable}{|c||c|c|c|c|c||c|c|c|c|c|}
\caption{Player hit vs. stand expectations (H17)%
\label{tab:hit-stand-expectations-H17}}\\ \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endfirsthead
\caption[]{(continued)}\\ \hline \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endhead
\input tables/hit-stand-basic-H17
\end{longtable}
\end{center}

\begin{center}
\begin{longtable}{|c||c|c|c|c|c||c|c|c|c|c|}
\caption{Player hit vs. stand expectations (S17)%
\label{tab:hit-stand-expectations-S17}}\\ \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endfirsthead
\caption[]{(continued)}\\ \hline \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endhead
\input tables/hit-stand-basic-S17
\end{longtable}
\end{center}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Double-down}
\label{sec:basic:double}

\index{double-down}
On the player's first two cards, the player is given the option to
double-down: double the original bet and take exactly one more card.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Surrender}
\label{sec:basic:surrender}

\index{surrender}
Some blackjack games allow an option to surrender, 
to end the hand by taking back half of the original
bet and giving up half.
There exist situation where the expected outcome of any other action 
is worse than just losing half of the bet outright.  

There exist two types of surrender:
early-surrender\index{surrender!early} and late-surrender{surrender!late}.
Early-surrender is very rare, it allows the player to 
end the hand by losing half of the original bet \emph{before}
the dealer peeks for blackjack.
Late-surrender is more common, and give the player the opportunity to
surrender the hand, again losing half the bet, 
at the time the player is prompted to act on her first two cards, 
which always happens \emph{after} peeking for blackjack.  
With late-surrender, the player still loses her whole bet against 
a dealer natural.
For now, we only evaluate late-surrender, as it is far more common.

To evaluate late-surrender, one simply compares the expected outcome
of any action (under post-peek conditions) against an outcome of $-0.5$.
When all other actions have a worse expected outcome than the surrender
penalty, it is to the player's advantage to surrender.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Split}
\label{sec:basic:split}

The player is always given the opportunity to split
the initial hand when it consists of equal-valued cards.
Any two 10-valued cards are also splittable.

\subsection{Double-after-split}
\label{sec:basic:DAS}

\index{double-after-split}

\subsection{Resplit}
\label{sec:basic:resplit}

\index{resplit}

\subsection{Split Aces}
\label{sec:basic:split-aces}

\index{split aces}
Paired Aces are often given exceptional rules in some games.
Some variations limit the resplitting of Aces, 
and another variation allows no further action after
up-cards are dealt on the split aces.  

\subsection{Action Expectations}
\label{sec:basic:action-expectations}

% TODO: smaller font
\begin{center}
\begin{longtable}{|c||c|c|c|c|c||c|c|c|c|c|}
\caption{Player's action expectations (H17)%
\label{tab:player-action-expectations-H17}}\\ \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endfirsthead
\caption[]{(continued)}\\ \hline \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endhead
\input tables/player-action-expectations-basic-H17
\end{longtable}
\end{center}

\begin{center}
\begin{longtable}{|c||c|c|c|c|c||c|c|c|c|c|}
\caption{Player's action expectations (S17)%
\label{tab:player-action-expectations-S17}}\\ \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endfirsthead
\caption[]{(continued)}\\ \hline \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endhead
\input tables/player-action-expectations-basic-S17
\end{longtable}
\end{center}

Table~\ref{tab:player-action-expectations-H17} summarizes of the
expectations per player action in every situation against the dealer
for the H17 variation.
Table~\ref{tab:player-action-expectations-S17} summarizes of the
expectations per player action in every situation against the dealer
for the S17 variation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Insurance}
\label{sec:basic:insurance}

\index{insurance}
In most games, insurance is offered when the dealer reveals an Ace.
Computing the insurance decision is an exercise in probability.
Most insurance payoffs pay 2:1, i.e., the insurance bet (half of the original)
pays the whole bet amount if the dealer does have a natural.
In other words, the insurance bet is equivalent to betting 
whether or not the dealer's hole card is a 10.
In a standard deck, 4/13 cards are 10-valued, 9/13 are not, 
so the odds are 9:4 against.  
If the payoff is only 2:1 (8:4), then insurance is a losing bet.
Hence, basic strategy dictates: \emph{never take insurance}.
Only when the odds of a 10-valued card is less than 2:1 against
is insurance a favorable side bet.

\subsection{Even-money}
\label{sec:basic:insurance:even-money}

\index{even money}
When the player has a natural blackjack, and the dealer is showing an 
Ace, the dealer sometimes offers the ``even money'' proposition, 
before peeking for a 10 in the hole.
If the player accepts, then she wins 1:1 on her original bet
instead of the typical 3:2, and the hand is over.
If the player declines, then the dealer peeks for a 10.
If the hole card is a 10, giving the dealer a natural, then the hand
is declared a push, and no money is exchanged.
Otherwise, the player's natural holds up against the dealer
and is paid out 3:2.

Under these circumstances, with the standard 3:2 blackjack payoff, 
even money is equivalent to the insurance side bet;
accepting ``even money'' is to the player's disadvantage.
With the standard card distribution, 
declining even money pays off 3:2 with probability 9/13, 
while the other 4/13 times pays nothing (push), 
so the expected value of declining is
$\frac{9}{13}\frac{3}{2}=\frac{27}{26}$,
whereas the expected value of accepting even money is only 1.  
Since $\frac{27}{26}>1$, it is better to decline even money, 
under basic strategy.

As an exercise to the reader, analyze the even money proposition
given a 6:5 payoff for natural blackjack.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Peeking}
\label{sec:basic:peeking}

\index{peeking}
This section addresses the impact of the peeking for a natural blackjack
on the odds of drawing cards, and computing probabilities of outcomes.
If you are only interested in strategy, you may skip this section.  

Under common blackjack variants, the dealer peeks at the hole card
to see if he already has a natural blackjack.
The dealer can only have a natural if the dealer's reveal card is an 
Ace or 10-valued, otherwise there is no need to peek at the hole card.
When an Ace is showing, the dealer checks for a 10 in the hole (usually 
after offering the insurance side bet), and when a 10 is showing, 
the dealer checks for an A in the hole (usually without side bets).
When the dealer does have a natural, the hand is over, 
and there is nothing else to calculate.
If the dealer does not have a natural, then play resumes, 
and the player is next to act, with additional information on the
distribution of cards remaining in the deck.

\subsection{Bayes' Theorem}
\label{sec:basic:peeking:bayes}
\index{Bayes' Theorem}
\index{conditional probability}
\index{probability!conditional}

Bayes' Theorem defines a mathematical relationship between
probabilities of two events and the \emph{conditional probabilities}
of one event given the other.

\begin{eqnarray}
\Prob{A|B} &=& \frac{\Prob{B|A}\Prob{A}}{\Prob{B}} \label{eqn:bayes}
\end{eqnarray}

Bayes' Theorem applies to computing post-peek conditional probabilities
because knowledge of one event (eliminated hole card value)
influences the probability distribution of drawing the next card.

We define events $A$ and $B$ prior to the peeking of any hole cards.
\begin{itemize}
\item Let $A_m$ be the event of drawing card $m:m\neq{}10$ 
from the deck of $N$ cards.
\item Let $A_{10}$ be the event of drawing a 10 card from the same deck.
\item Let $B$ be the event of drawing a non-10 card from the same deck.
\end{itemize}

\noindent
Let $N_k$ denote the number of $k$-valued cards in the deck of size $N$,
with $\Sum{k=1}{10}=N$.

\noindent
Let $N_{-k}=N-N_k$, for shorthand.

\noindent
Their respective probabilities are:
\begin{eqnarray}
\Prob{A_m} &=& \frac{N_m}{N}\\
\Prob{A_{10}} &=& \frac{N_{10}}{N}\\
\Prob{B} &=& \frac{N_{-10}}{N}
\end{eqnarray}

\noindent
The conditional probability of $B|A_m$ follows from removing a non-10 card
from the deck, 
and the conditional probability of $B|A_{10}$ follows from removing a 10 card
from the deck.

\begin{eqnarray}
\Prob{B|A_m} &=& \frac{N-1-N_{10}}{N-1} \nonumber \\
&=& \frac{N_{-10}-1}{N-1}\\
\Prob{B|A_{10}} &=& \frac{N-1-\Paren{N_{10}-1}}{N-1} \nonumber \\
&=& \frac{N_{-10}}{N-1}
\end{eqnarray}

\noindent
It follows from Bayes' Theorem (Equation~\ref{eqn:bayes}) that
the conditional probabilities of $A|B$ are:

\begin{eqnarray}
\Prob{A_m|B} &=& \frac{N_m}{N}\frac{N_{-10}-1}{N-1}\frac{N}{N_{-10}} \nonumber \\
&=& \frac{N_m}{N-1}\frac{N_{-10}-1}{N_{-10}} \label{eqn:Am_B} \\
\Prob{A_{10}|B} &=& \frac{N_{10}}{N}\frac{N_{-10}}{N-1}\frac{N}{N{-10}-1} \nonumber \\
&=& \frac{N_{10}}{N-1}\frac{N_{-10}}{N{-10}-1} \label{eqn:A10_B}
\end{eqnarray}

Relative to the \emph{priori} probabilities $\Prob{A_m}$ the
\emph{posteriori} probabilities makes sense;
eliminating a non-10 card from the deck increases the likelihood
of drawing a 10 card next, and decreases the likelihood of drawing
a non-10 card next.
The same analysis applies to the situation where the hole card
is known to not be an Ace.

As a sanity check, we confirm that $\Sum{j=1}{10}{\Prob{A_j|B}}$ = 1.
\begin{eqnarray}
\Sum{j=1}{10}{\Prob{A_j|B}} &=&
\Prob{A_{10}|B} +\Sum{j}{j\neq{}10}{\Prob{A_j|B}}\\
&=& \frac{N_{10}}{N-1}
  +\frac{N_{-10}-1}{\Paren{N-1}\Paren{N_{-10}}} \Sum{j}{j\neq{}10}{N_j} \label{eqn:post_peek} \\
&=& \frac{N_{10}}{N-1} +\frac{\Paren{N_{-10}}\Paren{N_{-10}-1}}{\Paren{N-1}\Paren{N_{-10}}}\\
&=& \frac{N_{10}}{N-1} +\frac{N_{-10}-1}{N-1}\\
&=& \frac{N_{10}+N_{-10}-1}{N-1}\\
&=& 1
\end{eqnarray}

Note also that in the infinite-deck limit, there is no difference
between the \emph{priori} and \emph{posteriori} probabilities because
the knowledge of the hole card no longer affects the relative distribution of 
remaining cards:
\begin{eqnarray}
\forall k: \Lim{N\rightarrow\infty}{\Prob{A_k|B}} &=& \frac{N_k}{N}
\end{eqnarray}

\noindent
Example calculations:
\begin{center}
\begin{tabular}{|c|c|c||c|c|}
\hline
$N$ & $N_{10}$ & $N_m$ & $\Prob{A_{10}|B}$ & $\Prob{A_m|B}$ \\ \hline \hline
13 & 4 & 1 & 4/12 & 2/27 \\ \hline
26 & 8 & 2 & 8/25 & 17/225 \\ \hline
52 & 16 & 4 & 16/51 & 35/459 \\ \hline
\end{tabular}
\end{center}

% table?
Another way to interpret the post-peeking probabilities is by treating 
the term coefficients as weights of the \emph{priori} distribution.
Before peeking, the weight of drawing each card $m$ is exactly
$N_m$, thus each \emph{priori} probability is $N_m/N$.
If we take Equation~\ref{eqn:post_peek} and multiply both sides
by the common denominator to acquire integer weights (whose sum is 
$\Paren{N-1}\Paren{N_{-10}}$),
we see that $N_{10}$ is weighted by $N_{-10}$ and for $m\neq{}10$, 
$N_m$ is weighted by $N_{-10}-1$.
This unequal weighting accounts for the relative change in 
conditional probabilities given event $B$.
Eliminating the common denominator can be used to efficiently implement the
random card generator without having to perform division.

\subsection{Accumulating unknown hole cards}
\label{sec:basic:peeking:accumulate}

As a deck or shoe is played, there may be times when the hole card
is never revealed.  This can occur if the player (or all players)
bust or surrender. 
When this happens, the dealer need not play out his hand; 
he may discard his revealed card and the hole card without revealing
the hole card.
When the dealer shows neither a 10 nor Ace, 
there is no information about the hole card;
it may as well be replaced among the remaining cards.  
However, when the dealer peeks for a natural blackjack,
there is partial information about the hole card
and the probability distribution of the remaining cards.  
When it is the dealer's turn to play, 
revealing the hole card provides certain information about 
what cards remain in the deck.  
The previous section assumed that prior to the hand, 
no peeked hole cards were discarded in previous hands.
This section computes the impact of accumulating discarded peeked hole cards
on probability of drawing cards.  

The previous problem can be generalized:
What are the \emph{posteriori} probabilities of $A|B^d$
when $B^d$ is the event that $d$ hole cards are known to be not 10?

Event $B^d$ is now the case where $d$ non-10 cards are
removed from a deck of $N$.
The probability of $B^d$ is:

\begin{eqnarray}
\Prob{B^d} &=& \frac{N_{-10}}{N}\frac{N_{-10}}{N-1}\cdots\frac{N_{-10}}{N-\Paren{d-1}} \nonumber \\
&=& \frac{N_{-10}^d}{\Prod{i=0}{d-1}{\Paren{N-i}}}
\end{eqnarray}

\noindent
The conditional probabilities of $B^d|A_k$ follows from 
removing a 10 or non-10 card from the deck.
Bear in mind that as each successive non-10 is drawn, 
the denominator diminishes.

\begin{eqnarray}
\Prob{B^d|A_m} &=& \frac{N_{-10}-1}{N-1}\frac{N_{-10}-1}{N-2}\cdots\frac{N_{-10}-1}{N-d} \nonumber \\
&=& \frac{\Paren{N_{-10}-1}^d}{\Prod{i=1}{d}{\Paren{N-i}}}\\
\Prob{B^d|A_{10}} &=& \frac{N_{-10}}{N-1}\frac{N_{-10}}{N-2}\cdots\frac{N_{-10}}{N-d} \nonumber \\
&=& \frac{N_{-10}^d}{\Prod{i=1}{d}{\Paren{N-i}}}
\end{eqnarray}

\noindent
Applying Bayes' Theorem yields $\Prob{A_k|B^d}$:
\begin{eqnarray}
\Prob{A_m|B^d} &=& \Prob{B^d|A_m}\frac{\Prob{A_m}}{\Prob{B^d}} \nonumber \\
&=& \frac{\Paren{N_{-10}-1}^d}{\Prod{i=1}{d}{\Paren{N-i}}}
\frac{N_m}{N} \frac{\Prod{i=0}{d-1}{\Paren{N-i}}}{N_{-10}^d} \nonumber \\
&=& \frac{\Paren{N_{-10}-1}^d}{\Paren{N-d}}
\frac{N_m}{N} \frac{N}{N_{-10}^d} \nonumber \\
&=& \frac{\Paren{N_{-10}-1}^d}{\Paren{N-d}}
\frac{N_m}{N} \frac{N}{N_{-10}^d} \nonumber \\
&=& \frac{N_m}{N-d} \Paren{\frac{N_{-10}-1}{N_{-10}}}^d \label{eqn:Am_Bd} \\
\Prob{A_10|B^d} &=& \Prob{B^d|A_10}\frac{\Prob{A_10}}{\Prob{B^d}} \nonumber \\
&=& \frac{\Paren{N_{-10}}^d}{\Prod{i=1}{d}{\Paren{N-i}}}
\frac{N_{10}}{N} \frac{\Prod{i=0}{d-1}{\Paren{N-i}}}{N_{-10}^d} \nonumber \\
&=& \frac{\Paren{N_{-10}}^d}{\Paren{N-d}}
\frac{N_{10}}{N} \frac{N}{N_{-10}^d} \nonumber \\
&=& \frac{N_{10}}{N-d} \label{eqn:A10_Bd}
\end{eqnarray}

\noindent
Substituting for $d=1$ gives us Equations~\ref{eqn:Am_B} and~\ref{eqn:A10_B}.

Exercise.
Verify that:
\begin{eqnarray}
\Sum{k}{10}{\Prob{A_k|B^d}} &=& 1
\end{eqnarray}

If we consider the relative \emph{posteriori} weights $A_k|B^d$, 
eliminating the common denominator reveals that
$A_m$ is weighted by $\Paren{N_{10}-1}^d$ and
$A_10$ is weighted by $\Paren{N_{10}}^d$.

Again, the above derivation also works for evaluating
when there are $e$ non-Ace cards discarded,
which we denote as $C^e$.

Now suppose that there are $d$ discards that are known to not be 10,
\emph{and} $e$ discards that are known not to be Ace, 
what is $\Prob{A_k|B^d C^e}$?

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Edges}
\label{sec:basic:edges}

% another chapter?
This section quantifies the overall edge of the game.

