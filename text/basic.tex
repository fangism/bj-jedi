% "basic.tex"

\chapter{Basic Strategy}
\label{sec:basic}

This chapter not only reveals the well-known optimal basic strategy
of Blackjack, but it also mathematically derives the strategy 
in great detail.

Assumptions: infinite deck approximation, as if cards drawn are
immediately replaced to eliminate the effects of history.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Hit vs. Stand}
\label{sec:basic:hit-stand}

The most common decision the player faces in any situation
is whether to hit or stand.
It is also the most important to learn and master first.

\subsection{Standing}
\label{sec:basic:hit-stand:stand}

\begin{table}[ht!]
\caption{Player's stand edges (H17, pre-peek)}
\begin{center}
\input tables/player-stand-H17-pre-peek
\end{center}
\label{tab:player-stand-H17-pre-peek}
\end{table}

\begin{table}[ht!]
\caption{Player's stand edges (H17, post-peek)}
\begin{center}
\input tables/player-stand-H17-post-peek
\end{center}
\label{tab:player-stand-H17-post-peek}
\end{table}

If we combine Table~\ref{tab:win-lose} and
Table~\ref{tab:dealer-final-H17-pre-peek} (pre-peek, H17) 
using outcome weights of $+1$ for a win, $-1$ for lose, and $0$ for push, 
the result is the expected winnings per unit bet, 
is Table~\ref{tab:player-stand-H17-pre-peek}.
Note that a player natural blackjack (row:BJ) is weighted by the 
blackjack payoff of $3:2$ ($+1.5$).
With any other blackjack payoff, this row would be re-computed accordingly.

For post-peek conditions, Table~\ref{tab:win-lose} is combined with
Table~\ref{tab:dealer-final-H17-post-peek} (post-peek, H17) to produce
Table~\ref{tab:player-stand-H17-post-peek}.
The only columns which differ between these tables are when
the dealer's reveal card is an Ace or 10, since those are the only cards
that provide information about the hole card
when the dealer peeks for blackjack.

Intuitively, as the player's hand value increases up to 21, 
her expected outcome also monotonically increases.
This is trend is expected because the corresponding player value rows in
Table~\ref{tab:win-lose} show the sets of winning scenarios
grow with hand value, and the set of losing scenarios diminish with
hand value.  

\begin{table}[ht!]
\caption{Player's stand edges (S17, pre-peek)}
\begin{center}
\input tables/player-stand-S17-pre-peek
\end{center}
\label{tab:player-stand-S17-pre-peek}
\end{table}

\begin{table}[ht!]
\caption{Player's stand edges (S17, post-peek)}
\begin{center}
\input tables/player-stand-S17-post-peek
\end{center}
\label{tab:player-stand-S17-post-peek}
\end{table}

For the S17 variation, the same computation produces
Table~\ref{tab:player-stand-S17-pre-peek} (pre-peek), and
Table~\ref{tab:player-stand-S17-post-peek} (post-peek).

Decision evaluations will use the post-peek tables when
comparing to against the expected outcomes of other actions, 
because the player does not have a chance to act before
being assured that the dealer does not have blackjack.  
% exception: no peek variation

\subsection{Hitting}
\label{sec:basic:hit-stand:hit}

The obvious hit decisions are when the player's hand is 11 or lower,
as it cannot result in a bust, and since any total $\le{}16$ is
worth the same, the hand can only improve by hitting.  
% If it is better to stand than hit at X, then it is also better to
% stand than hit at all X+k (for hard totals).

The expected outcome of hitting in each state $s_i$ 
can be computed recursively using the following equations:

\begin{eqnarray}
\ExpOpt{s_i} &=& \Max{\ExpAct{hit}{s_i}}{\ExpAct{stand}{s_i}}\\
\ExpAct{hit}{s_i} &=& \Sum{j=1}{10}{\Prob{c=j}\ExpOpt{s_{i\rightarrow{}j}}}
\end{eqnarray}

\noindent
To follow dependency ordering, the expectations $\ExpAct{hit}{s_i}$
must be evaluated starting from the player's terminal states 
(21, bust) and working backwards.  

\begin{center}
\begin{longtable}{|c||c|c|c|c|c||c|c|c|c|c|}
\caption{Player hit vs. stand expectations (H17)%
\label{tab:hit-stand-expectations-H17}}\\ \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endfirsthead
\caption[]{(continued)}\\ \hline \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endhead
\input tables/hit-stand-basic-H17
\end{longtable}
\end{center}

\begin{center}
\begin{longtable}{|c||c|c|c|c|c||c|c|c|c|c|}
\caption{Player hit vs. stand expectations (S17)%
\label{tab:hit-stand-expectations-S17}}\\ \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endfirsthead
\caption[]{(continued)}\\ \hline \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endhead
\input tables/hit-stand-basic-S17
\end{longtable}
\end{center}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Double-down}
\label{sec:basic:double}

\index{double-down}
On the player's first two cards, the player is given the option to
double-down: double the original bet and take exactly one more card.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Surrender}
\label{sec:basic:surrender}

\index{surrender}
Some blackjack games allow an option to surrender, 
to end the hand by taking back half of the original
bet and giving up half.
There exist situation where the expected outcome of any other action 
is worse than just losing half of the bet outright.  

There exist two types of surrender:
early-surrender\index{surrender!early} and late-surrender{surrender!late}.
Early-surrender is very rare, it allows the player to 
end the hand by losing half of the original bet \emph{before}
the dealer peeks for blackjack.
Late-surrender is more common, and give the player the opportunity to
surrender the hand, again losing half the bet, 
at the time the player is prompted to act on her first two cards, 
which always happens \emph{after} peeking for blackjack.  
With late-surrender, the player still loses her whole bet against 
a dealer natural.
For now, we only evaluate late-surrender, as it is far more common.

To evaluate late-surrender, one simply compares the expected outcome
of any action (under post-peek conditions) against an outcome of $-0.5$.
When all other actions have a worse expected outcome than the surrender
penalty, it is to the player's advantage to surrender.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Split}
\label{sec:basic:split}

The player is always given the opportunity to split
the initial hand when it consists of equal-valued cards.
Any two 10-valued cards are also splittable.

\subsection{Double-after-split}
\label{sec:basic:DAS}

\index{double-after-split}

\subsection{Resplit}
\label{sec:basic:resplit}

\index{resplit}

\subsection{Split Aces}
\label{sec:basic:split-aces}

\index{split aces}
Paired Aces are often given exceptional rules in some games.
Some variations limit the resplitting of Aces, 
and another variation allows no further action after
up-cards are dealt on the split aces.  

\subsection{Action Expectations}
\label{sec:basic:action-expectations}

% TODO: smaller font
\begin{center}
\begin{longtable}{|c||c|c|c|c|c||c|c|c|c|c|}
\caption{Player's action expectations (H17)%
\label{tab:player-action-expectations-H17}}\\ \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endfirsthead
\caption[]{(continued)}\\ \hline \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endhead
\input tables/player-action-expectations-basic-H17
\end{longtable}
\end{center}

\begin{center}
\begin{longtable}{|c||c|c|c|c|c||c|c|c|c|c|}
\caption{Player's action expectations (S17)%
\label{tab:player-action-expectations-S17}}\\ \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endfirsthead
\caption[]{(continued)}\\ \hline \hline
$\frac{\textrm{reveal}\rightarrow}{\textrm{player}\downarrow}$
&2&3&4&5&6&7&8&9&10&A \\ \hline \hline
\endhead
\input tables/player-action-expectations-basic-S17
\end{longtable}
\end{center}

Table~\ref{tab:player-action-expectations-H17} summarizes of the
expectations per player action in every situation against the dealer
for the H17 variation.
Table~\ref{tab:player-action-expectations-S17} summarizes of the
expectations per player action in every situation against the dealer
for the S17 variation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Insurance}
\label{sec:basic:insurance}

\index{insurance}
In most games, insurance is offered when the dealer reveals an Ace.
Computing the insurance decision is an exercise in probability.
Most insurance payoffs pay 2:1, i.e., the insurance bet (half of the original)
pays the whole bet amount if the dealer does have a natural.
In other words, the insurance bet is equivalent to betting 
whether or not the dealer's hole card is a 10.
In a standard deck, 4/13 cards are 10-valued, 9/13 are not, 
so the odds are 9:4 against.  
If the payoff is only 2:1 (8:4), then insurance is a losing bet.
Hence, basic strategy dictates: \emph{never take insurance}.
Only when the odds of a 10-valued card is less than 2:1 against
is insurance a favorable side bet.

\subsection{Even-money}
\label{sec:basic:insurance:even-money}

\index{even money}
When the player has a natural blackjack, and the dealer is showing an 
Ace, the dealer sometimes offers the ``even money'' proposition, 
before peeking for a 10 in the hole.
If the player accepts, then she wins 1:1 on her original bet
instead of the typical 3:2, and the hand is over.
If the player declines, then the dealer peeks for a 10.
If the hole card is a 10, giving the dealer a natural, then the hand
is declared a push, and no money is exchanged.
Otherwise, the player's natural holds up against the dealer
and is paid out 3:2.

Under these circumstances, with the standard 3:2 blackjack payoff, 
even money is equivalent to the insurance side bet;
accepting ``even money'' is to the player's disadvantage.
With the standard card distribution, 
declining even money pays off 3:2 with probability 9/13, 
while the other 4/13 times pays nothing (push), 
so the expected value of declining is
$\frac{9}{13}\cdot\frac{3}{2}=\frac{27}{26}$,
whereas the expected value of accepting even money is only 1.  
Since $\frac{27}{26}>1$, it is better to decline even money, 
under basic strategy.

As an exercise to the reader, analyze the even money proposition
given a 6:5 payoff for natural blackjack.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Peeking}
\label{sec:basic:peeking}

\index{peeking}
This section addresses the impact of the peeking for a natural blackjack
on the odds of drawing cards, and computing probabilities of outcomes.
If you are only interested in strategy, you may skip this section.  

Under common blackjack variants, the dealer peeks at the hole card
to see if he already has a natural blackjack.
The dealer can only have a natural if the dealer's reveal card is an 
Ace or 10-valued, otherwise there is no need to peek at the hole card.
When an Ace is showing, the dealer checks for a 10 in the hole (usually 
after offering the insurance side bet), and when a 10 is showing, 
the dealer checks for an A in the hole (usually no side bets).
When the dealer does have a natural, the hand is over, 
and there is nothing else to calculate.
If the dealer does not have a natural, then play resumes, 
and the player is next to act, with additional information on the
distribution of cards remaining in the deck.

\subsection{Impact of peeking on drawing odds}
\label{sec:basic:peeking:drawing_odds}
% Problem formulation:
Given $N$ cards remaining, distributed over $k$ distinct values 
each weighted $N_k$, and 1 of those $N$ cards is taken aside 
(as the hole card, $h$), and the knowledge that $h\neq{}10$, 
what is the probability of drawing card $m$ next, 
or $\Prob{x=m|h\neq{}10}$ where $x$ is drawn from the 
remaining $N-1$ cards?

\begin{eqnarray}
\Prob{x=10|h\neq{}10} &=& \frac{N_{10}}{N-1}\\
\Prob{x=m,m\neq{}10|h\neq{}10} &=&
  \Prob{h=m} \Prob{x=m|h=m} \nonumber \\
& &  +\Prob{h\neq{}m} \Prob{x=m|h\neq{}m}\\
&=& \frac{N_m}{N-N_{10}}\cdot\frac{N_m-1}{N-1}
  +\frac{N-N_{10}-N_m}{N-N_{10}}\cdot\frac{N_m}{N-1}\\
&=& \frac{N_m\Paren{N-N_{10}-1}}{\Paren{N-1}\Paren{N-N_{10}}}
\end{eqnarray}

As a sanity check, we confirm that $\Sum{m=1}{10}{\Prob{x=m|h\neq{}10}}=1$.
\begin{eqnarray}
\Sum{m=1}{10}{\Prob{x=m|h\neq{}10}} &=&
\Prob{x=10|h\neq{}10} +\Sum{m:m\neq{}10}{}{\Prob{x=m|h\neq{}10}}\\
&=& \frac{N_{10}}{N-1}
  +\frac{N-N_{10}-1}{\Paren{N-1}\Paren{N-N_{10}}} \Sum{m:m\neq{}10}{}{N_m} \label{eqn:post_peek} \\
&=& \frac{N_{10}}{N-1} +\frac{\Paren{N-N_{10}}\Paren{N-N_{10}-1}}{\Paren{N-1}\Paren{N-N_{10}}}\\
&=& \frac{N_{10}}{N-1} +\frac{N-N_{10}-1}{N-1}\\
&=& \frac{N_{10}+N-N_{10}-1}{N-1}\\
&=& 1
\end{eqnarray}

Note also that in the infinite-deck limit, there is no difference
between the priori and posteriori probabilities because
the knowledge of the hole card no longer affects the relative distribution of 
remaining cards:
\begin{eqnarray}
\Lim{N\rightarrow\infty}{\Prob{x=m|h\neq{}10}} &=& \frac{N_m}{N}
\end{eqnarray}

\noindent
Example calculations:
\begin{center}
\begin{tabular}{|c|c|c||c|c|}
\hline
$N$ & $N_10$ & $N_m$ & $\Prob{x=10|h\neq{}10}$ & $\Prob{x=m|h\neq{}10}$ \\ \hline \hline
13 & 4 & 1 & 4/12 & 2/27 \\ \hline
26 & 8 & 2 & 8/25 & 17/225 \\ \hline
52 & 16 & 4 & 16/51 & 35/459 \\ \hline
\end{tabular}
\end{center}

The above analysis can be repeated for the case where the hole card $h$
is known to not be an Ace.  

\begin{eqnarray}
\Prob{x=A|h\neq{}A} &=& \frac{N_{A}}{N-1}\\
\Prob{x=m,m\neq{}A|h\neq{}A} &=&
  \frac{N_m\Paren{N-N_{A}-1}}{\Paren{N-1}\Paren{N-N_{A}}}
\end{eqnarray}

% table?
Another way of looking at how the odds change after peeking is
by adjusting the weighting of the \emph{priori} distribution.
Before peeking, the weight of drawing each card $m$ is exactly
$N_m$, thus each probability is $N_m/N$.
If we take Equation~\ref{eqn:post_peek} and multiply both sides
by the common denominator to acquire integer weights (whose sum is 
$\Paren{N-1}\Paren{N-N_{10}}$),
we see that $N_10$ is weighted by $N-N_{10}$ and for $m\neq{}10$, 
$N_m$ is weighted by $N-N_{10}-1$.
In other words, knowledge that the hole card cannot be 10 increases
the likelihood of drawing a 10 from the remaining cards.
This property can be used to efficiently adjust the
random card generator without having to perform division.

\subsection{Accumulating unknown hole cards}
\label{sec:basic:peeking:accumulate}

As a deck or shoe is played, there may be times when the hole card
is never revealed.  This can occur if the player (or all players)
bust or surrender. 
When this happens, the dealer need not play out his hand; 
he may discard his revealed card and the hole card without revealing
the hole card.
When the dealer shows neither a 10 nor Ace, 
there is no information about the hole card;
it may as well be replaced among the remaining cards.  
However, when the dealer peeks for a natural blackjack,
there is partial information about the hole card
and the probability distribution of the remaining cards.  
When it is the dealer's turn to play, 
revealing the hole card provides certain information about 
what cards remain in the deck.  
The previous section assumed that prior to the hand, 
no peeked hole cards were discarded.
This section computes the impact of discarded peeked hole cards
on probability of drawing cards.  

TODO: generalize

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Edges}
\label{sec:basic:edges}

% another chapter?
This section quantifies the overall edge of the game.

